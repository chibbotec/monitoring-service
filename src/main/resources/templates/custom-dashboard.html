<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JPA 쿼리 모니터링 대시보드</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- CSS는 여기에 추가 -->
  <link href="custom-dashboard.css" rel="stylesheet">
</head>
<body>
<div class="dashboard-container">
  <!-- 대시보드 헤더 -->
  <div class="dashboard-header">
    <h1><i class="bi bi-database-check"></i> JPA 쿼리 모니터링 대시보드</h1>
    <div class="dashboard-controls">
      <div id="lastUpdated" class="text-light">마지막 업데이트: --:--:--</div>
      <button id="pauseButton" class="btn btn-outline-light btn-sm">
        <i class="bi bi-pause-circle"></i> 일시정지
      </button>
      <button id="refreshButton" class="btn btn-light btn-sm">
        <i class="bi bi-arrow-clockwise"></i> 새로고침
      </button>
    </div>
  </div>

  <!-- 서비스 선택 -->
  <div class="mb-4">
    <div class="row">
      <div class="col-md-6">
        <label for="serviceSelector" class="form-label">서비스 선택:</label>
        <select id="serviceSelector" class="form-select">
          <option value="all">전체 서비스</option>
          <option value="techinterview">Tech Interview 서비스</option>
          <option value="apigateway">API Gateway</option>
        </select>
      </div>
    </div>
  </div>

  <!-- 서비스 상태 표시 -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">서비스 상태</div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <div>
              <span class="status-indicator" id="techinterviewStatus"></span>
              <span>Tech Interview 서비스</span>
            </div>
            <div id="techinterviewStatusText">확인 중...</div>
          </div>
          <div class="d-flex justify-content-between">
            <div>
              <span class="status-indicator" id="apigatewayStatus"></span>
              <span>API Gateway</span>
            </div>
            <div id="apigatewayStatusText">확인 중...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 요약 지표 -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card metric-card bg-primary bg-opacity-10">
        <div class="metric-value" id="totalQueries">0</div>
        <div class="metric-label">총 쿼리 수</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card bg-success bg-opacity-10">
        <div class="metric-value" id="selectQueries">0</div>
        <div class="metric-label">SELECT 쿼리</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card bg-warning bg-opacity-10">
        <div class="metric-value" id="modifyQueries">0</div>
        <div class="metric-label">변경 쿼리 (INSERT/UPDATE/DELETE)</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card bg-danger bg-opacity-10">
        <div class="metric-value" id="avgQueryTime">0 ms</div>
        <div class="metric-label">평균 쿼리 실행 시간</div>
      </div>
    </div>
  </div>

  <!-- 쿼리 종류별 차트 -->
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          쿼리 종류별 분포
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="queryTypeChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          시간별 쿼리 추이
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="queryTimelineChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 쿼리 실행 시간 분포 -->
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          쿼리 실행 시간 분포
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="queryTimeDistributionChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 최근 쿼리 로그 -->
  <div class="row mt-4">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span><i class="bi bi-list-ul"></i> 최근 쿼리 로그</span>
          <div>
            <select id="queryFilter" class="form-select form-select-sm" style="width: auto; display: inline-block;">
              <option value="all">모든 쿼리</option>
              <option value="slow">느린 쿼리만 (>100ms)</option>
            </select>
            <button id="clearLogs" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-trash"></i> 로그 지우기
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-light">
              <tr>
                <th width="10%">시간</th>
                <th width="10%">서비스</th>
                <th width="10%">쿼리 종류</th>
                <th width="10%">실행 시간</th>
                <th width="60%">SQL</th>
              </tr>
              </thead>
              <tbody id="queryLogTable">
              <!-- 여기에 자바스크립트로 로그 추가 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript 부분은 여기에 추가 -->
<script src="custom-dashboard.js"></script>
</body>
</html>